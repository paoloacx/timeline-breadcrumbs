<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Breadcrumbs</title>
    
    <meta name="theme-color" content="#ffffff"/>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">

    <link rel="stylesheet" href="styles.css?v=1.2">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js" defer></script>
</head>
<body>

    <header class="mac-header">
        <div class="header-left">
            <span class="header-title">Breadcrumbs</span>
            <span id="sync-status" style="margin-left: 10px;">(Offline)</span>
        </div>
        <div class="header-right">
            <button id="sync-btn" class="mac-button" title="Sync/Refresh">üîÑ</button>
            
            <button id="login-btn" class="mac-button mac-button-primary hidden" style="margin-left: 10px;">Sign In</button>
            <div id="auth-container" class="hidden" style="margin-left: 10px; display: flex; align-items: center; gap: 8px;">
                <img id="user-photo" src="" alt="User" style="width: 28px; height: 28px; border-radius: 50%; border: 2px solid #000;">
                <span id="user-name" style="font-size: 13px; max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></span>
                <button id="logout-btn" class="mac-button" title="Sign Out">Sign Out</button>
            </div>
        </div>
    </header>

    <main>
        
        <div id="form-window" class="mac-window hidden" style="max-width: 500px; margin-bottom: 20px;">
            <div class="mac-title-bar">
                <span>üìù New Breadcrumb</span>
                <button id="cancel-btn">‚úï</button>
            </div>
            <div class="mac-content">
                <div class="form-group">
                    <label class="mac-label">Time</label>
                    <input type="datetime-local" class="mac-input" id="datetime-input">
                </div>
                
                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <label class="mac-label">Mood</label>
                        <button id="mood-config-btn" class="mac-button" style="padding: 2px 6px; font-size: 12px;">‚öôÔ∏è</button>
                    </div>
                    <div id="mood-selector" class="mood-selector-grid">
                        </div>
                    <div id="mood-config" class="hidden" style="margin-top: 10px; padding: 10px; border: 2px solid #ccc; background: #f9f9f9;">
                        <div id="mood-config-list"></div>
                        <button id="save-mood-btn" class="mac-button mac-button-primary" style="margin-top: 10px;">Save Moods</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="mac-label" for="note-input">Note</label>
                    <textarea id="note-input" class="mac-input" rows="4" placeholder="What's happening?"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="mac-label">Media</label>
                    <div class="media-controls">
                        <label class="mac-button" for="image-input" style="cursor: pointer;">üì∏ Add Photos</label>
                        <input type="file" id="image-input" accept="image/*" multiple style="display: none;">
                        
                        <div class="audio-recorder">
                            <button id="record-btn" class="mac-button">üéôÔ∏è Record</button>
                            <button id="stop-record-btn" class="mac-button" disabled>‚èπÔ∏è Stop</button>
                        </div>
                    </div>
                    <div id="image-previews" class="previews-container"></div>
                    <div id="audio-preview" classs="previews-container"></div>
                </div>

                <div class="form-group">
                    <label class="mac-label">Location</label>
                    <button id="gps-btn" class="mac-button" style="width: 100%; margin-bottom: 10px;">üåç Use GPS (Weather & Location)</button>
                    <input type="text" id="location-input" class="mac-input" placeholder="Location (e.g., City)">
                    <input type="text" id="weather-input" class="mac-input" placeholder="Weather (e.g., Sunny, 20¬∞C)" style="margin-top: 8px;">
                    <div id="form-map" class="mini-map-container" style="display: none; margin-top: 10px;"></div>
                </div>
                
                <div class="form-actions">
                    <button id="delete-btn" class="mac-button mac-button-danger hidden">Delete</button>
                    <button id="save-btn" class="mac-button mac-button-primary" style="flex: 1;">üíæ Save</button>
                </div>
            </div>
        </div>
        
        <div id="timer-window" class="mac-window hidden" style="max-width: 500px; margin-bottom: 20px;">
            <div class="mac-title-bar">
                <span>‚è±Ô∏è New Time Event</span>
                <button id="cancel-time-btn">‚úï</button>
            </div>
            <div class="mac-content">
                <div class="form-group">
                    <label class="mac-label">Time</label>
                    <input type="datetime-local" class="mac-input" id="datetime-input-time">
                </div>
                
                <div class="form-group">
                    <label class="mac-label">Duration (minutes)</label>
                    <div id="duration-selector" class="selector-grid">
                        </div>
                </div>
                
                <div class="form-group">
                    <label class="mac-label">Activity</label>
                    <div id="activity-selector" class="selector-grid">
                        </div>
                </div>
                
                <div class="form-group">
                    <label class="mac-label" for="time-optional-note">Optional Note</label>
                    <textarea id="time-optional-note" class="mac-input" rows="2" placeholder="Optional details..."></textarea>
                </div>
                
                <div class="form-actions">
                    <button id="delete-time-btn" class="mac-button mac-button-danger hidden">Delete</button>
                    <button id="create-time-btn" class="mac-button mac-button-primary" style="flex: 1;" disabled>Create Event</button>
                </div>
            </div>
        </div>
        
        <div id="track-window" class="mac-window hidden" style="max-width: 500px; margin-bottom: 20px;">
            <div class="mac-title-bar">
                <span>üìä Quick Track</span>
                <button id="cancel-track-btn">‚úï</button>
            </div>
            <div class="mac-content">
                <div class="form-group">
                    <label class="mac-label">Time</label>
                    <input type="datetime-local" class="mac-input" id="datetime-input-track">
                </div>
                
                <div class="form-group">
                    <label class="mac-label">Track Item</label>
                    <div id="track-selector" class="selector-grid">
                        </div>
                </div>

                <div class="form-group">
                    <label class="mac-label" for="track-optional-note">Optional Note</label>
                    <textarea id="track-optional-note" class="mac-input" rows="2" placeholder="Optional details..."></textarea>
                </div>
                
                <div class="form-actions">
                    <button id="delete-track-btn" class="mac-button mac-button-danger hidden">Delete</button>
                    <button id="save-track-btn" class="mac-button mac-button-primary" style="flex: 1;" disabled>Save Track</button>
                </div>
            </div>
        </div>

        <div id="spent-window" class="mac-window hidden" style="max-width: 500px; margin-bottom: 20px;">
            <div class="mac-title-bar">
                <span>üí∞ Track Expense</span>
                <button id="cancel-spent-btn">‚úï</button>
            </div>
            <div class="mac-content">
                <div class="form-group">
                    <label class="mac-label">Time</label>
                    <input type="datetime-local" class="mac-input" id="datetime-input-spent">
                </div>
                
                <div class="form-group">
                    <label class="mac-label" for="spent-description">Description</label>
                    <input type="text" id="spent-description" class="mac-input" placeholder="e.g., Coffee, Groceries">
                </div>
                
                <div class="form-group">
                    <label class="mac-label" for="spent-amount">Amount (‚Ç¨)</label>
                    <input type="number" id="spent-amount" class="mac-input" placeholder="0.00" min="0" step="0.01">
                </div>

                <div class="form-actions">
                    <button id="delete-spent-btn" class="mac-button mac-button-danger hidden">Delete</button>
                    <button id="save-spent-btn" class="mac-button mac-button-primary" style="flex: 1;">Save Spent</button>
                </div>
            </div>
        </div>

        <div id="recap-form" class="mac-window hidden" style="max-width: 500px; margin-bottom: 20px;">
            <div class="mac-title-bar">
                <span>üåü Day Recap</span>
                <button id="cancel-recap-btn">‚úï</button>
            </div>
            <div class="mac-content">
                <div class="form-group">
                    <label class="mac-label">Date</label>
                    <input type="datetime-local" class="mac-input" id="datetime-input-recap">
                </div>

                <div class="form-group">
                    <label class="mac-label">How was your day? (Rating: <span id="recap-rating-value">5</span>/10)</label>
                    <input type="range" id="recap-rating" class="mac-slider" min="1" max="10" value="5">
                </div>
                
                <div class="form-group">
                    <label class="mac-label" for="recap-reflection">Reflection</label>
                    <textarea id="recap-reflection" class="mac-input" rows="4" placeholder="How did you feel? What went well?"></textarea>
                </div>

                <div class="form-group">
                    <label class="mac-label">Highlights (Top 3)</label>
                    <input type="text" id="recap-highlight-1" class="mac-input" placeholder="Highlight 1">
                    <input type="text" id="recap-highlight-2" class="mac-input" placeholder="Highlight 2" style="margin-top: 8px;">
                    <input type="text" id="recap-highlight-3" class="mac-input" placeholder="Highlight 3" style="margin-top: 8px;">
                </div>

                <div class="form-group">
                    <label class="mac-label" for="recap-bso">Soundtrack of the Day (BSO)</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="recap-bso" class="mac-input" placeholder="Search song or artist...">
                        <button id="recap-bso-search-btn" class="mac-button">Search</button>
                    </div>
                    <div id="recap-bso-results" style="margin-top: 10px;"></div>
                    <input type="hidden" id="recap-selected-track">
                </div>
                
                <div class="form-actions">
                    <button id="delete-recap-btn" class="mac-button mac-button-danger hidden">Delete</button>
                    <button id="save-recap-btn" class="mac-button mac-button-primary" style="flex: 1;">Save Recap</button>
                </div>
            </div>
        </div>


        <div id="timeline-container">
            </div>
        
        <div id="empty-state" class="mac-window hidden" style="text-align: center; padding: 40px; max-width: 400px;">
            <div style="font-size: 48px; margin-bottom: 20px;">üìù</div>
            <h2 style="margin-bottom: 10px;">It's quiet in here...</h2>
            <p style="color: #555;">Press the <span class="fab-example">+</span> button to add your first breadcrumb!</p>
        </div>

    </main>

    <footer id="footer" class="mac-footer">
        <div class="footer-item">
            <span class="footer-label">Admin:</span>
            <button id="stats-btn" class="mac-button" title="Stats">üìä</button>
            <button id="settings-btn" class="mac-button" title="Settings">‚öôÔ∏è</button>
        </div>
        <div class="footer-item">
            <span class="footer-label">Export:</span>
            <button id="export-csv-btn">CSV</button>
            <button id="export-ics-btn">iCal</button>
        </div>
        <div class="footer-item">
            <span class="footer-label">Total:</span>
            <span id="footer-count">0</span>
        </div>
    </footer>
    
    <div class="fab-container">
        <div class="fab-action-wrapper hidden" id="fab-recap">
            <span class="fab-label">Recap</span>
            <div class="fab-action">üåü</div>
        </div>
        <div class="fab-action-wrapper hidden" id="fab-spent">
            <span class="fab-label">Spent</span>
            <div class="fab-action">üí∞</div>
        </div>
        <div class="fab-action-wrapper hidden" id="fab-track">
            <span class="fab-label">Track</span>
            <div class="fab-action">üìä</div>
        </div>
        <div class="fab-action-wrapper hidden" id="fab-time">
            <span class="fab-label">Time</span>
            <div class="fab-action">‚è±Ô∏è</div>
        </div>
        <div class="fab-action-wrapper hidden" id="fab-crumb">
            <span class="fab-label">Crumb</span>
            <div class="fab-action">üìù</div>
        </div>
        
        <div id="fab-main" class="fab-main-button">
            <span id="fab-icon">+</span>
        </div>
    </div>

    <div id="preview-modal" class="preview-modal">
        <div class="preview-content">
            <div class="mac-title-bar">
                <span>üîç Preview Entry</span>
                <button id="preview-close-btn">‚úï</button>
            </div>
            <div id="preview-body" class="mac-content">
                </div>
        </div>
    </div>
    
    <div id="stats-modal" class="preview-modal">
        <div class="preview-content" style="max-width: 600px;">
            <div class="mac-title-bar">
                <span>üìä Statistics</span>
                <button id="stats-close-btn">‚úï</button>
            </div>
            <div id="stats-content" class="mac-content stats-grid">
                </div>
        </div>
    </div>

    <div id="settings-modal" class="preview-modal">
        <div class="preview-content" style="max-width: 600px;">
            <div class="mac-title-bar">
                <span>‚öôÔ∏è Settings</span>
                <button id="settings-close-btn">‚úï</button>
            </div>
            <div id="settings-body" class="mac-content">
                <p style="margin-bottom: 20px;">Settings are saved locally and synced to the cloud if you are logged in.</p>
                
                <div class="form-group">
                    <label class="mac-label">Timer Durations (in minutes)</label>
                    <div id="settings-durations-list">
                        </div>
                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <input type="number" id="new-duration-input" class="mac-input" placeholder="min" style="width: 80px;">
                        <button class="mac-button add-duration-btn">Add</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="mac-label">Timer Activities</label>
                    <div id="settings-activities-list">
                        </div>
                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <input type="text" id="new-activity-input" class="mac-input" placeholder="Activity name">
                        <button class="mac-button add-activity-btn">Add</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="mac-label">Track Items: Meals</label>
                    <div id="settings-meals-list">
                        </div>
                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <input type="text" id="new-meal-input" class="mac-input" placeholder="e.g., üç≥ Breakfast">
                        <button class="mac-button add-meal-btn">Add</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="mac-label">Track Items: Tasks</label>
                    <div id="settings-tasks-list">
                        </div>
                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <input type="text" id="new-task-input" class="mac-input" placeholder="e.g., üíä Medicine">
                        <button class="mac-button add-task-btn">Add</button>
                    </div>
                </div>
                
                <hr style="border: 1px solid #ccc; margin: 24px 0;">
                
                <button id="settings-save-btn" class="mac-button mac-button-primary" style="width: 100%;">üíæ Save All Settings</button>
            </div>
        </div>
    </div>
    
    <div id="loading-overlay" class="hidden">
        <div class="loading-spinner"></div>
        <div id="loading-text">Loading...</div>
    </div>


    <script type="module" src="app.js?v=1.2"></script>
</body>
</html>
