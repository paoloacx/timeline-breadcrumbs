<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline Breadcrumbs</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Iconos SVG
        const Calendar = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const MapPin = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const Image = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
        );

        const Download = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Plus = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const X = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Cloud = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        function TimelineBreadcrumbs() {
            const [entries, setEntries] = useState([]);
            const [showForm, setShowForm] = useState(false);
            const [currentEntry, setCurrentEntry] = useState({
                note: '',
                location: '',
                weather: '',
                images: [],
                useGPS: false
            });

            useEffect(() => {
                const saved = localStorage.getItem('timeline-entries');
                if (saved) {
                    setEntries(JSON.parse(saved));
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('timeline-entries', JSON.stringify(entries));
            }, [entries]);

            const requestLocation = () => {
                if (!navigator.geolocation) {
                    alert('Tu navegador no soporta geolocalización');
                    return;
                }

                setCurrentEntry(prev => ({ ...prev, useGPS: true }));
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        setCurrentEntry(prev => ({
                            ...prev,
                            location: `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`,
                            useGPS: false
                        }));
                    },
                    (error) => {
                        let errorMsg = 'No se pudo obtener la ubicación';
                        if (error.code === 1) {
                            errorMsg = 'Permiso denegado. Por favor permite el acceso a tu ubicación.';
                        } else if (error.code === 2) {
                            errorMsg = 'Ubicación no disponible.';
                        } else if (error.code === 3) {
                            errorMsg = 'Tiempo de espera agotado.';
                        }
                        alert(errorMsg);
                        setCurrentEntry(prev => ({ ...prev, useGPS: false }));
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            };

            const handleImageUpload = (e) => {
                const files = Array.from(e.target.files);
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setCurrentEntry(prev => ({
                            ...prev,
                            images: [...prev.images, reader.result]
                        }));
                    };
                    reader.readAsDataURL(file);
                });
            };

            const removeImage = (index) => {
                setCurrentEntry(prev => ({
                    ...prev,
                    images: prev.images.filter((_, i) => i !== index)
                }));
            };

            const saveEntry = () => {
                if (!currentEntry.note.trim()) {
                    alert('Por favor escribe una nota');
                    return;
                }

                const newEntry = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    ...currentEntry
                };

                setEntries(prev => [newEntry, ...prev]);
                setCurrentEntry({ note: '', location: '', weather: '', images: [], useGPS: false });
                setShowForm(false);
            };

            const deleteEntry = (id) => {
                if (confirm('¿Eliminar esta entrada?')) {
                    setEntries(prev => prev.filter(e => e.id !== id));
                }
            };

            const exportToCSV = () => {
                const headers = ['Fecha y Hora', 'Nota', 'Ubicación', 'Clima', 'Imágenes'];
                const rows = entries.map(e => [
                    new Date(e.timestamp).toLocaleString(),
                    e.note,
                    e.location || '',
                    e.weather || '',
                    e.images.length
                ]);
                
                const csv = [headers, ...rows].map(row => 
                    row.map(cell => `"${cell}"`).join(',')
                ).join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `timeline-${Date.now()}.csv`;
                a.click();
            };

            const exportToICS = () => {
                const icsEvents = entries.map(e => {
                    const date = new Date(e.timestamp);
                    const dateStr = date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                    
                    return `BEGIN:VEVENT
UID:${e.id}@timeline-breadcrumbs
DTSTAMP:${dateStr}
DTSTART:${dateStr}
SUMMARY:${e.note.substring(0, 50)}
DESCRIPTION:${e.note}${e.location ? '\\nUbicación: ' + e.location : ''}${e.weather ? '\\nClima: ' + e.weather : ''}
LOCATION:${e.location || ''}
END:VEVENT`;
                }).join('\n');

                const ics = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Timeline Breadcrumbs//ES
CALSCALE:GREGORIAN
METHOD:PUBLISH
${icsEvents}
END:VCALENDAR`;

                const blob = new Blob([ics], { type: 'text/calendar' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `timeline-${Date.now()}.ics`;
                a.click();
            };

            const formatDate = (timestamp) => {
                const date = new Date(timestamp);
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);

                const isToday = date.toDateString() === today.toDateString();
                const isYesterday = date.toDateString() === yesterday.toDateString();

                if (isToday) {
                    return `Hoy, ${date.toLocaleTimeString('es', { hour: '2-digit', minute: '2-digit' })}`;
                } else if (isYesterday) {
                    return `Ayer, ${date.toLocaleTimeString('es', { hour: '2-digit', minute: '2-digit' })}`;
                } else {
                    return date.toLocaleString('es', { 
                        day: 'numeric', 
                        month: 'short', 
                        year: 'numeric',
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Timeline Breadcrumbs</h1>
                            <p className="text-gray-600">Captura momentos de tu vida automáticamente</p>
                            
                            <div className="flex gap-3 mt-4">
                                <button
                                    onClick={() => setShowForm(!showForm)}
                                    className="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                >
                                    <Plus size={20} />
                                    Nueva Entrada
                                </button>
                                
                                {entries.length > 0 && (
                                    <>
                                        <button
                                            onClick={exportToCSV}
                                            className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition"
                                        >
                                            <Download size={20} />
                                            CSV
                                        </button>
                                        <button
                                            onClick={exportToICS}
                                            className="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                                        >
                                            <Calendar size={20} />
                                            iCal
                                        </button>
                                    </>
                                )}
                            </div>
                        </div>

                        {showForm && (
                            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">Nueva Anotación</h2>
                                
                                <textarea
                                    value={currentEntry.note}
                                    onChange={(e) => setCurrentEntry(prev => ({ ...prev, note: e.target.value }))}
                                    placeholder="¿Qué está pasando?"
                                    className="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    rows="4"
                                />

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label className="flex items-center gap-2 text-sm text-gray-700 mb-2">
                                            <MapPin size={16} />
                                            Ubicación
                                        </label>
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={currentEntry.location}
                                                onChange={(e) => setCurrentEntry(prev => ({ ...prev, location: e.target.value }))}
                                                placeholder="Agregar ubicación"
                                                className="flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                            />
                                            <button
                                                onClick={requestLocation}
                                                disabled={currentEntry.useGPS}
                                                className="px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50 disabled:bg-gray-400"
                                            >
                                                {currentEntry.useGPS ? '...' : 'GPS'}
                                            </button>
                                        </div>
                                    </div>

                                    <div>
                                        <label className="flex items-center gap-2 text-sm text-gray-700 mb-2">
                                            <Cloud size={16} />
                                            Clima
                                        </label>
                                        <input
                                            type="text"
                                            value={currentEntry.weather}
                                            onChange={(e) => setCurrentEntry(prev => ({ ...prev, weather: e.target.value }))}
                                            placeholder="Soleado, nublado, etc."
                                            className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                        />
                                    </div>
                                </div>

                                <div className="mb-4">
                                    <label className="flex items-center gap-2 text-sm text-gray-700 mb-2">
                                        <Image size={16} />
                                        Imágenes
                                    </label>
                                    <input
                                        type="file"
                                        accept="image/*"
                                        multiple
                                        onChange={handleImageUpload}
                                        className="w-full p-2 border border-gray-300 rounded-lg"
                                    />
                                    
                                    {currentEntry.images.length > 0 && (
                                        <div className="flex flex-wrap gap-2 mt-3">
                                            {currentEntry.images.map((img, idx) => (
                                                <div key={idx} className="relative">
                                                    <img src={img} alt="" className="w-20 h-20 object-cover rounded" />
                                                    <button
                                                        onClick={() => removeImage(idx)}
                                                        className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600"
                                                    >
                                                        <X size={12} />
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                <div className="flex gap-3">
                                    <button
                                        onClick={saveEntry}
                                        className="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                    >
                                        Guardar
                                    </button>
                                    <button
                                        onClick={() => {
                                            setShowForm(false);
                                            setCurrentEntry({ note: '', location: '', weather: '', images: [], useGPS: false });
                                        }}
                                        className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
                                    >
                                        Cancelar
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="space-y-4">
                            {entries.length === 0 ? (
                                <div className="bg-white rounded-lg shadow-lg p-12 text-center">
                                    <Calendar size={48} className="mx-auto text-gray-400 mb-4" />
                                    <p className="text-gray-500 text-lg">No hay entradas aún</p>
                                    <p className="text-gray-400 text-sm">Crea tu primera anotación para comenzar</p>
                                </div>
                            ) : (
                                entries.map((entry) => (
                                    <div key={entry.id} className="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition">
                                        <div className="flex justify-between items-start mb-3">
                                            <div className="flex items-center gap-2 text-sm text-gray-500">
                                                <Calendar size={16} />
                                                {formatDate(entry.timestamp)}
                                            </div>
                                            <button
                                                onClick={() => deleteEntry(entry.id)}
                                                className="text-red-500 hover:text-red-700"
                                            >
                                                <Trash2 size={18} />
                                            </button>
                                        </div>
                                        
                                        <p className="text-gray-800 text-lg mb-3">{entry.note}</p>
                                        
                                        <div className="flex flex-wrap gap-4 text-sm text-gray-600">
                                            {entry.location && (
                                                <div className="flex items-center gap-1">
                                                    <MapPin size={14} />
                                                    {entry.location}
                                                </div>
                                            )}
                                            {entry.weather && (
                                                <div className="flex items-center gap-1">
                                                    <Cloud size={14} />
                                                    {entry.weather}
                                                </div>
                                            )}
                                        </div>

                                        {entry.images.length > 0 && (
                                            <div className="flex flex-wrap gap-2 mt-4">
                                                {entry.images.map((img, idx) => (
                                                    <img
                                                        key={idx}
                                                        src={img}
                                                        alt=""
                                                        className="w-24 h-24 object-cover rounded-lg cursor-pointer hover:opacity-80 transition"
                                                        onClick={() => window.open(img)}
                                                    />
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TimelineBreadcrumbs />, document.getElementById('root'));
    </script>
</body>
</html>
